"""
snakemake --snakefile scripts/8_models/lms/snakefile_per_region -n 

snakemake --jobs 50 --snakefile scripts/8_models/lms/snakefile_per_region \
    --latency-wait 30 \
    -p \
    --default-resources mem_mb=51200 \
    --use-conda \
    --rerun-triggers mtime \
    --cluster '
      sbatch \
        --export=ALL \
        -n {threads} \
        -e logs/{name}.{jobid}.err \
        -o logs/{name}.{jobid}.out \
        --mem={resources.mem_mb} ' \
        --jn bayes_model.{name}.{jobid}.sh \
        --rerun-incomplete
"""

REGIONS=["region_promoter","region_gene","region_tss","region_exon","region_intron","region_down","region_up"]
METHODS=["high","gerp5"]

rule all:
    input:
        "scripts/8_models/lms/model_files/lms_per_region_total_add.R",
        "scripts/8_models/lms/model_files/lms_per_region_expressed_masked.R",
        expand("output/models/per_gene_region/lms_total_{method}_{region}_zi_29scaf.RData", region=REGIONS, method=METHODS),
        expand("output/models/per_gene_region/lms_expressed_masked_{method}_{region}_zi_29scaf.RData", region=REGIONS, method=METHODS)

rule run_bayes_total:
    input: 
        rscript = "scripts/combined_loads/models/lms_per_region_total_add.R"
    output:
        model = "output/models/per_gene_region/lms_total_{method}_{region}_zi_29scaf.RData"
    log: "logs/bayesmodel_total_{method}_{region}.log"
    shell:
        """
        Rscript --vanilla {input.rscript} {wildcards.method} {wildcards.region} {output.model} &> {log}
        """

rule run_bayes_expr_mask:
    input: 
        rscript = "scripts/combined_loads/models/lms_per_region_expressed_masked.R"
    output:
        model = "output/models/per_gene_region/lms_expressed_masked_{method}_{region}_zi_29scaf.RData"
    log: "logs/bayesmodel_expr_mask_{method}_{region}.log"
    shell:
        """
        Rscript --vanilla {input.rscript} {wildcards.method} {wildcards.region} {output.model} &> {log}
        """    