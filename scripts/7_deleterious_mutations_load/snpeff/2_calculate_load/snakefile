"""
snakemake --snakefile scripts/7_deleterious_mutations_load/snpeff/2_calculate_load/snakefile -n 

snakemake --jobs 50 --snakefile scripts/7_deleterious_mutations_load/snpeff/2_calculate_load/snakefile \
    --latency-wait 30 \
    -p \
    --default-resources mem_mb=51200 threads=1 \
    --use-conda \
    --rerun-triggers mtime \
    --cluster '
      sbatch \
        --export=ALL \
        -n {threads} \
        -e logs/{name}.{jobid}.err \
        -o logs/{name}.{jobid}.out \
        --mem={resources.mem_mb} ' \
        --jn load.{name}.{jobid}.sh \
        --rerun-incomplete
"""

IMPACT=["HIGH"] 

rule all:
    input: 
      expand("data/genomic/intermediate/snpef/ltet_ann_aa_snp_output_{impact}.vcf", impact = IMPACT),
      expand("output/load/snpeff/genetic_load_da_nosex_30scaf_{impact}.tsv", impact = IMPACT),
      expand("output/load/snpeff/genetic_load_da_nosex_total_additive_30scaf_{impact}.tsv", impact = IMPACT)

rule calculate_load:
    input: 
        vcf="results/snpeff/annotation/ltet_ann_aa_snp_output_{impact}.vcf"
    output:
        txt="output/load/snpeff/genetic_load_da_nosex_30scaf_{impact}.tsv"
    log: "log/calculate_load_{impact}.log"
    shell:
        """
        Rscript --vanilla scripts/7_deleterious_mutations_load/snpeff/2_calculate_load/calculate_load_snake.R {input.vcf} {output.txt} &> {log}
        """

rule load_additive:
    input: 
        vcf="results/snpeff/annotation/ltet_ann_aa_snp_output_{impact}.vcf"
    output:
        txt="output/load/snpeff/genetic_load_da_nosex_total_additive_30scaf_{impact}.tsv"
    log: "log/load_additive_{impact}.log"
    shell:
        """
        Rscript --vanilla scripts/7_deleterious_mutations_load/snpeff/2_calculate_load/calculate_load_snake_total_additive.R {input.vcf} {output.txt} &> {log}
        """